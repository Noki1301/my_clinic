{% extends 'base.html' %} {% block title %}Mening Qabullarim{% endblock %}
{%block content %}
<div class="container py-5">
	<h2 class="mb-4">Mening Qabullarim</h2>

	<div class="card shadow-sm">
		<div class="card-body">
			{% if appointments %}
			<div class="table-responsive">
				<table class="table table-hover">
					<thead class="table-light">
						<thead>
							<tr>
								<th>Sana</th>
								<th>Vaqt</th>
								<th>Shifokor</th>
								<th>Mutaxassislik</th>
								<th>Status</th>
								<th>Amallar</th>
							</tr>
						</thead>
					</thead>
					<tbody>
						{% for app in appointments %}
						<tr>
							<td>{{ app.date }}</td>
							<td>{{ app.time }}</td>
							<td>Dr. {{ app.doctor.last_name }}</td>
							<td>{{ app.doctor.get_speciality_display }}</td>

							<td>
								{% if app.status == 'completed' %}
								<span class="badge bg-success">Yakunlandi</span>
								{% else %}
								<span class="badge bg-secondary"
									>{{ app.get_status_display }}</span
								>
								{% endif %}
							</td>

							<td>
								{% if app.status == 'completed' %}
								<button
									type="button"
									class="btn btn-info btn-sm text-white"
									data-bs-toggle="modal"
									data-bs-target="#viewResult{{ app.id }}"
								>
									<i class="bi bi-eye"></i> Retseptni ko'rish
								</button>

								<div
									class="modal fade"
									id="viewResult{{ app.id }}"
									tabindex="-1"
								>
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header bg-success text-white">
												<h5 class="modal-title">üè• Shifokor xulosasi</h5>
												<button
													type="button"
													class="btn-close btn-close-white"
													data-bs-dismiss="modal"
												></button>
											</div>
											<div class="modal-body">
												<h6 class="fw-bold text-dark">Tashxis:</h6>
												<p class="p-3 bg-light rounded border">
													{{ app.diagnosis|default:"Kiritilmagan" }}
												</p>

												<h6 class="fw-bold text-dark mt-3">
													Retsept va Tavsiyalar:
												</h6>
												<p
													class="p-3 bg-light rounded border"
													style="white-space: pre-line"
												>
													{{ app.prescription|default:"Kiritilmagan" }}
												</p>

												<hr />
												<small class="text-muted"
													>Dr. {{ app.doctor.first_name }} {{
													app.doctor.last_name }} | {{ app.date }}</small
												>
											</div>
										</div>
									</div>
								</div>

								{% elif app.status == 'pending' %}
								<form action="..." ...>
									<button ...><i class="bi bi-trash"></i></button>
								</form>
								{% endif %}
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			{% else %}
			<div class="text-center py-4">
				<p class="text-muted">Sizda hali hech qanday qabul yo'q.</p>
				<a href="{% url 'home' %}" class="btn btn-primary">Shifokor tanlash</a>
			</div>
			{% endif %}
		</div>
	</div>
</div>

{% endblock %}

{% extends 'base.html' %} {% block title %}Mening Qabullarim{% endblock %}
{%block content %}
<div class="container py-5">
	<h2 class="mb-4">Mening Qabullarim</h2>

	<div class="card shadow-sm">
		<div class="card-body">
			{% if appointments %}
			<div class="table-responsive">
				<table class="table table-hover">
					<thead class="table-light">
						<thead>
							<tr>
								<th>Sana</th>
								<th>Vaqt</th>
								<th>Shifokor</th>
								<th>Mutaxassislik</th>
								<th>Status</th>
								<th>Amallar</th>
							</tr>
						</thead>
					</thead>
					<tbody>
						{% for app in appointments %}
						<tr>
							<td>{{ app.date }}</td>
							<td>{{ app.time }}</td>
							<td class="fw-bold">Dr. {{ app.doctor.last_name }}</td>
							<td>{{ app.doctor.get_speciality_display }}</td>
							<td>
								{% if app.status == 'pending' %}
								<span class="badge bg-warning text-dark">Kutilmoqda</span>
								{% elif app.status == 'confirmed' %}
								<span class="badge bg-success">Tasdiqlandi</span>
								{% elif app.status == 'cancelled' %}
								<span class="badge bg-danger">Bekor qilindi</span>
								{% else %}
								<span class="badge bg-secondary">Yakunlandi</span>
								{% endif %}
							</td>
							<td>
								{% if app.status == 'pending' %}
								<span class="badge bg-warning text-dark">Kutilmoqda</span>
								{% elif app.status == 'confirmed' %}
								<span class="badge bg-success">Tasdiqlandi</span>
								{% endif %}
							</td>

							<td>
								<button
									type="button"
									class="btn btn-outline-danger btn-sm"
									data-bs-toggle="modal"
									data-bs-target="#deleteModal{{ app.id }}"
									title="Bekor qilish"
								>
									<i class="bi bi-trash"></i>
								</button>
							</td>
							<div
								class="modal fade"
								id="deleteModal{{ app.id }}"
								tabindex="-1"
								aria-labelledby="deleteModalLabel{{ app.id }}"
								aria-hidden="true"
							>
								<div class="modal-dialog modal-dialog-centered">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="deleteModalLabel{{ app.id }}">
												Qabulni bekor qilish
											</h5>
											<button
												type="button"
												class="btn-close"
												data-bs-dismiss="modal"
												aria-label="Yopish"
											></button>
										</div>

										<div class="modal-body">
											Rostdan ham bu qabulni bekor qilmoqchimisiz?
											<br /><strong>{{ app.date }} — {{ app.time }}</strong>
										</div>

										<div class="modal-footer">
											<button
												type="button"
												class="btn btn-secondary"
												data-bs-dismiss="modal"
											>
												Yo‘q
											</button>

											<form
												action="{% url 'delete_appointment' app.id %}"
												method="post"
											>
												{% csrf_token %}
												<button type="submit" class="btn btn-danger">
													Ha, bekor qilaman
												</button>
											</form>
										</div>
									</div>
								</div>
							</div>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			{% else %}
			<div class="text-center py-4">
				<p class="text-muted">Sizda hali hech qanday qabul yo'q.</p>
				<a href="{% url 'home' %}" class="btn btn-primary">Shifokor tanlash</a>
			</div>
			{% endif %}
		</div>
	</div>
</div>

{% endblock %}
